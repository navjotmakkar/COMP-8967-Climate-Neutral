<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Tables</title>
    <style>
        .table-container {
            margin-bottom: 20px; /* Add space between tables */
        }

        .table-bordered {
            border-width: 1px 1px 1px 0px;
            border-style: solid solid solid none;
            border-color: #DDD #DDD #DDD -moz-use-text-color;
            border-collapse: collapse;
            border-radius: 4px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .table-bordered th,
        .table-bordered td {
            min-width: 150px;
            padding: 8px;
            line-height: 20px;
            text-align: left;
            vertical-align: top;
            border: 1px solid #DDD;
        }

        .table-bordered th {
            background-color: #add8e6; /* Light Blue */
            color: #333333;
        }

        td.delete_row {
            text-align: center;
        }

        .delete_row:hover {
            color: red;
            cursor: pointer;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Input field styles */
        .modal-content input, .modal-content select {
            width: calc(100% - 16px);
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .modal-content button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }

        .modal-content button:hover {
            background-color: #45a049;
        }

        .radio-label {
            margin-right: 10px;
        }

        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

  <!-- First Table -->
  <div class="table-container">
    <table id="myTable1" class="table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Weight</th>
          <th>Direction</th>
          <th>Evaluation Type</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <button onclick="openModal('categoryModal')">Add category</button>
  </div>

  <!-- Second Table -->
<div class="table-container">
        <table id="myTable2" class="table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <button id="addScenarioButton" onclick="openModal('scenarioModal')" disabled>Add scenario</button>
    </div>


  <!-- Category Modal -->
<div id="categoryModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('categoryModal')">&times;</span>
    <h2>Add Category</h2>
    <form id="categoryForm">
      <label for="categoryName">Name:</label>
      <input type="text" name="categoryName" required><br>
      
      <label for="categoryWeight">Weight:</label>
      <input type="number" step="0.01" name="categoryWeight" required><br>
      
      <label>Direction:</label>
      <label class="radio-label"><input type="radio" name="categoryDirection" value="positive" required> Positive</label>
      <label class="radio-label"><input type="radio" name="categoryDirection" value="negative" required> Negative</label><br>
      
      <label>Evaluation Type:</label>
      <select name="categoryEvaluationType" required>
        <option value="ordinal">Ordinal</option>
        <option value="linear">Linear</option>
        <option value="descriptive">Descriptive</option>
      </select><br>
      
      <button type="button" onclick="submitCategory()">Submit</button>
    </form>
  </div>
</div>

<!-- Scenario Modal -->
<div id="scenarioModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('scenarioModal')">&times;</span>
    <h2>Add Scenario</h2>
    <form id="scenarioForm">
      <label for="scenarioName">Name:</label>
      <input type="text" name="scenarioName" required><br>

      <!-- Categories will be dynamically added here -->
      <div id="categoryValues"></div> <!-- Container for category values -->
      
      <button type="button" onclick="submitScenario()">Submit</button>
    </form>
  </div>
</div>


  <script>
    function myCreateFunction(tableId) {
      var table = document.getElementById(tableId);
      var i = table.rows.length;
      var row = table.insertRow(i);

      var inputTypes = ['text', 'number', 'radio', 'select'];
      var inputNames = ['categoryName', 'categoryWeight', 'categoryDirection', 'categoryEvaluationType'];

      for (var j = 0; j < inputTypes.length; j++) {
        var cell = row.insertCell(j);
        if (inputTypes[j] === 'radio') {
          cell.innerHTML = `
            <label class="radio-label"><input type="radio" name="${inputNames[j]}" value="positive"> Positive</label>
            <label class="radio-label"><input type="radio" name="${inputNames[j]}" value="negative"> Negative</label>`;
        } else if (inputTypes[j] === 'select') {
          cell.innerHTML = `
            <select name="${inputNames[j]}">
              <option value="ordinal">Ordinal</option>
              <option value="linear">Linear</option>
              <option value="descriptive">Descriptive</option>
            </select>`;
        } else {
          cell.innerHTML = `<input type="${inputTypes[j]}" name="${inputNames[j]}">`;
        }
      }

      var cell = row.insertCell(row.cells.length);
      cell.innerHTML = "x";
      cell.classList.add("delete_row");
      cell.addEventListener("click", function () {
        deleteRow(this);
      }, false);

      // After adding a category, check the count and enable/disable the button.
      checkCategoryCount();
    }

    function deleteRow(r) {
      var i = r.parentNode.rowIndex;
      var table = r.parentNode.parentNode;

      if (i !== 0) {
        table.deleteRow(i);

        // After deleting a row, check the category count and enable/disable the button.
        if (table.id === 'myTable1') {
          checkCategoryCount();
        }
      }

      // Additional check after deletion
      if (table.id === 'myTable1') {
        checkCategoryCount();
      }
    }

    function openModal(modalId) {
    var modal = document.getElementById(modalId);
    modal.style.display = "block";

    // Reset the form fields
    var form = modal.querySelector('form');
    form.reset();

    if (modalId === 'scenarioModal') {
        // Get the number of categories
        var categoryTable = document.getElementById('myTable1');
        var categoryCount = categoryTable.rows.length - 1; // Subtract 1 for the header row.

        // Generate input fields based on the number of categories
        var modalContent = document.querySelector(`#${modalId} .modal-content`);
        var categoriesInput = '';

        for (var i = 0; i < categoryCount; i++) {
            var categoryName = categoryTable.rows[i + 1].cells[0].innerText; // Get category name from the first table
            var categoryEvaluationType = categoryTable.rows[i + 1].cells[3].innerText.toLowerCase(); // Get evaluation type

            var valueType = '';
            if (categoryEvaluationType === 'linear') {
                valueType = 'number';
            } else if (categoryEvaluationType === 'descriptive') {
                valueType = 'select';
            } else if (categoryEvaluationType === 'ordinal') {
                valueType = 'text';
            }

            var valueOptions = '';
            if (categoryEvaluationType === 'descriptive') {
                valueOptions = `
                    <select name="categoryValue${i}" required>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                    </select><br>
                `;
            } else {
                valueOptions = `<input type="${valueType}" name="categoryValue${i}" required><br>`;
            }

            categoriesInput += `
                <label for="categoryValue:${i}">${categoryName} </label>
                ${valueOptions}
            `;
        }

        var categoryValuesContainer = document.getElementById('categoryValues');
        categoryValuesContainer.innerHTML = categoriesInput;

        // Update the scenario table headers
        updateScenarioTableHeaders(categoryCount);
    }
}
function updateScenarioTableHeaders(categoryCount) {
    var scenarioTable = document.getElementById('myTable2');
    var headerRow = scenarioTable.rows[0];

    // Clear existing headers (keeping only the Name column)
    while (headerRow.cells.length > 1) {
        headerRow.deleteCell(1);
    }

    // Add new headers based on the number of categories
    for (var i = 1; i <= categoryCount; i++) {
        var newCategoryHeader = document.createElement('th');
        newCategoryHeader.textContent = 'Category' + i;
        headerRow.appendChild(newCategoryHeader);
    }
}



    function closeModal(modalId) {
      document.getElementById(modalId).style.display = "none";
    }

    function submitCategory() {
  var form = document.getElementById('categoryForm');
  var formData = new FormData(form);

  var name = formData.get('categoryName');
  var weight = parseFloat(formData.get('categoryWeight')); // Parse as float
  var direction = formData.get('categoryDirection');
  var evaluationType = formData.get('categoryEvaluationType');

  if (name && !isNaN(weight) && direction && evaluationType) {
    var table = document.getElementById('myTable1');
    var i = table.rows.length;
    var row = table.insertRow(i);

    var values = {
      Name: name,
      Weight: weight,
      Direction: direction,
      EvaluationType: evaluationType
    };

    for (var key in values) {
      var cell = row.insertCell();
      cell.innerHTML = values[key];
    }

    var cell = row.insertCell(row.cells.length);
    cell.innerHTML = "x";
    cell.classList.add("delete_row");
    cell.addEventListener("click", function () {
      deleteRow(this);
    }, false);

    closeModal('categoryModal');

    // Convert to JSON and log to console
    var jsonValues = JSON.stringify(values);
    console.log("Entered Category (JSON):", jsonValues);
  } else {
    alert('Please fill out all fields with valid values.');
  }

      // After adding a category, check the count and enable/disable the button.
      checkCategoryCount();
    }

    function submitScenario() {
    var form = document.getElementById('scenarioForm');
    var formData = new FormData(form);

    var name = formData.get('scenarioName');
    if (name) {
        var table = document.getElementById('myTable2');
        var i = table.rows.length;
        var row = table.insertRow(i);

        var values = { Name: name };

        // Get values of category fields
        var categoryTable = document.getElementById('myTable1');
        var categoryCount = categoryTable.rows.length - 1;
        for (var j = 0; j < categoryCount; j++) {
            var categoryValue = formData.get(`categoryValue${j}`);
            values['Category' + (j + 1)] = categoryValue;
        }

        for (var key in values) {
            var cell = row.insertCell();
            cell.innerHTML = values[key];
        }

        closeModal('scenarioModal');

        // Log the entered scenario data as JSON
        var jsonData = JSON.stringify(values);
        console.log("Entered Scenario Data (JSON):", jsonData);

        // Update the scenario table headers (if necessary)
        updateScenarioTableHeaders(categoryCount);
    } else {
        alert('Please fill out all fields.');
    }
}




    function checkCategoryCount() {
      var categoryTable = document.getElementById('myTable1');
      var categoryCount = categoryTable.rows.length - 1; // Subtract 1 for the header row.

      var addScenarioButton = document.getElementById('addScenarioButton');
      addScenarioButton.disabled = categoryCount < 3;
    }

    
  </script>
</body>
</html>
